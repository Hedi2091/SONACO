@model IEnumerable<MonApplicationMVC.Models.Entree>

<h2>Entrées</h2>

<!-- Bouton pour afficher la popup d'ajout -->
<button type="button" id="showAddPopup" class="btn btn-primary">Ajouter une Entrée</button>

<hr />

<!-- Formulaire de recherche (toujours visible) -->
<div id="searchForm">
    <h3>Rechercher des Entrées</h3>
    <form id="dynamicSearchForm">
        <div class="form-group">
            <label for="searchNumEntree">Numéro d'Entrée</label>
            <input type="text" class="form-control" id="searchNumEntree" name="searchNumEntree" />
        </div>

        <div class="form-group">
            <label for="searchDateArr">Date d'Arrivée</label>
            <input type="date" class="form-control" id="searchDateArr" name="searchDateArr" />
        </div>
    </form>
</div>

<hr />

<!-- Popup pour le formulaire d'ajout -->
<dialog id="addPopup" class="popup">
    <h3>Formulaire d'ajout</h3>
    <form asp-action="Create" method="post">
        <div class="form-group">
            <label for="NumEntree">Numéro d'Entrée</label>
            <input type="text" class="form-control" id="NumEntree" name="NumEntree" required />
        </div>

        <div class="form-group">
            <label for="DateArr">Date d'Arrivée</label>
            <input type="date" class="form-control" id="DateArr" name="DateArr" required />
        </div>

        <div class="form-group">
            <label for="CodeFour">Code Fournisseur</label>
            <input type="text" class="form-control" id="CodeFour" name="CodeFour" required />
        </div>

        <div class="form-group">
            <label for="CodeClient">Code Client</label>
            <input type="text" class="form-control" id="CodeClient" name="CodeClient" required />
        </div>

        <div class="form-group">
            <label for="NbRouleau">Nombre de Rouleaux</label>
            <input type="number" class="form-control" id="NbRouleau" name="NbRouleau" required />
        </div>

        <div class="form-group">
            <label for="Largeur">Largeur</label>
            <input type="number" step="0.01" class="form-control" id="Largeur" name="Largeur" required />
        </div>

        <div class="form-group">
            <button type="submit" class="btn btn-primary btn-block">Soumettre</button>
            <button type="button" class="btn btn-secondary btn-block" id="closeAddPopup">Fermer</button>
        </div>
    </form>
</dialog>

<!-- Liste des entrées -->
<h3>Liste des Entrées</h3>
<div id="entreeList">
    <table class="table">
        <thead>
            <tr>
                <th>Numéro d'Entrée</th>
                <th>Date d'Arrivée</th>
                <th>Code Fournisseur</th>
                <th>Code Client</th>
                <th>Nombre de Rouleaux</th>
                <th>Largeur</th>
            </tr>
        </thead>
        <tbody id="entreeTableBody">
            @foreach (var entree in Model)
            {
                <tr>
                    <td>@entree.NumEntree</td>
                    <td>@entree.DateArr.ToString("dd/MM/yyyy")</td>
                    <td>@entree.CodeFour</td>
                    <td>@entree.CodeClient</td>
                    <td>@entree.NbRouleau</td>
                    <td>@entree.Largeur</td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    // Ouverture et fermeture de la popup d'ajout
    const addPopup = document.getElementById("addPopup");

    document.getElementById("showAddPopup").onclick = () => addPopup.showModal();
    document.getElementById("closeAddPopup").onclick = () => addPopup.close();

    // Recherche dynamique
    document.getElementById("searchNumEntree").addEventListener("input", performSearch);
    document.getElementById("searchDateArr").addEventListener("input", performSearch);

    function performSearch() {
        const searchNumEntree = document.getElementById("searchNumEntree").value;
        const searchDateArr = document.getElementById("searchDateArr").value;

        fetch(`/Entree/SearchEntrees?searchNumEntree=${searchNumEntree}&searchDateArr=${searchDateArr}`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById("entreeTableBody");
                tableBody.innerHTML = ""; // Efface les anciennes lignes

                if (data.length > 0) {
                    data.forEach(entree => {
                        const row = `
                            <tr>
                                <td>${entree.numEntree}</td>
                                <td>${entree.dateArr}</td>
                                <td>${entree.codeFour}</td>
                                <td>${entree.codeClient}</td>
                                <td>${entree.nbRouleau}</td>
                                <td>${entree.largeur}</td>
                            </tr>`;
                        tableBody.innerHTML += row;
                    });
                } else {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center">Aucun résultat trouvé</td>
                        </tr>`;
                }
            })
            .catch(error => console.error("Erreur lors de la recherche :", error));
    }
</script>

<style>
    dialog.popup {
        width: 50%;
        border: none;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    dialog::backdrop {
        background: rgba(0, 0, 0, 0.4);
    }
</style>
